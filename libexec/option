#!/bin/sh

parse() { # No subshell
  export HSENV_GHC=
  export HSENV_NAME=
  export HSENV_LOG_LEVEL=3
  export HSENV_COMMAND=hsenv_main
  export HSENV_PS1_INDICATOR=true
  export HSENV_SANITY_CHECK=true
  export HSENV_SHARE_CABAL_CACHE=true
  export HSENV_BOOTSTRAP_CABAL=false

  for parsed_option in $*; do
    case $parsed_option in
      --ghc=*)
        HSENV_GHC=${parsed_option#*=}
        shift
        ;;
      --name=*)
        HSENV_NAME=${parsed_option#*=}
        shift
        ;;
      -v|--verbose)
        [ $HSENV_LOG_LEVEL -lt 4 ] && HSENV_LOG_LEVEL=4
        shift
        ;;
      --very-verbose)
        [ $HSENV_LOG_LEVEL -lt 5 ] && HSENV_LOG_LEVEL=5
        shift
        ;;
      --version)
        HSENV_COMMAND=hsenv_version
        return
        ;;
      -h|--help)
        HSENV_COMMAND=hsenv_help
        return
        ;;
      --dont-share-cabal-cache)
        HSENV_SHARE_CABAL_CACHE=false
        shift
        ;;
      --make-cmd=*)
        MAKE=${parsed_option#*=}
        shift
        ;;
      --tar-cmd=*)
        TAR=${parsed_option#*=}
        shift
        ;;
      --no-ps1-indicator)
        HSENV_PS1_INDICATOR=false
        shift
        ;;
      --skip-sanity-check)
        HSENV_SANITY_CHECK=false
        shift
        ;;
      --bootstrap-cabal)
        HSENV_BOOTSTRAP_CABAL=true
        shift
        ;;
      *)
        hsenv_abort Error: unknown option \`$parsed_option\'
        ;;
    esac
  done
}

is_version() (
  echo $* | $EGREP "^[0-9]+(\.[0-9]+)*$" > /dev/null
)

is_url() (
  echo $* | $EGREP "^https?://.+$" > /dev/null
)

installation_of() (
  if [ -z "$1" ]; then
    echo transplant_local_executable
  elif is_version $1; then
    echo install_remote_source
  elif is_url $1; then
    echo install_remote
  else
    echo install_local
  fi
)
